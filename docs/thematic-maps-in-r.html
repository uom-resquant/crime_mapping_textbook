<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Thematic maps in R | Crime Mapping in R</title>
  <meta name="description" content="Worksheets for labs of Crime Mapping course" />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Thematic maps in R | Crime Mapping in R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Worksheets for labs of Crime Mapping course" />
  <meta name="github-repo" content="maczokni/crime_mapping_textbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Thematic maps in R | Crime Mapping in R" />
  
  <meta name="twitter:description" content="Worksheets for labs of Crime Mapping course" />
  

<meta name="author" content="Reka Solymosi and Juanjo Medina" />


<meta name="date" content="2026-02-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="making-maps-in-r.html"/>
<link rel="next" href="performing-spatial-operations-in-r.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.3/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Crime Mapping in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prelude</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>0.1</b> Introduction</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>0.2</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html"><i class="fa fa-check"></i><b>1</b> A first lesson about R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#install-r-r-studio"><i class="fa fa-check"></i><b>1.1</b> Install R &amp; R Studio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-1-identifying-your-operating-system"><i class="fa fa-check"></i><b>1.1.1</b> Activity 1: Identifying your operating system</a></li>
<li class="chapter" data-level="1.1.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-2-install-r-r-studio"><i class="fa fa-check"></i><b>1.1.2</b> Activity 2: Install R &amp; R Studio</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#open-up-and-explore-rstudio"><i class="fa fa-check"></i><b>1.2</b> Open up and explore RStudio</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-3-opening-up-the-script-pane"><i class="fa fa-check"></i><b>1.2.1</b> Activity 3: Opening up the script pane</a></li>
<li class="chapter" data-level="1.2.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#the-four-panes-of-r-studio"><i class="fa fa-check"></i><b>1.2.2</b> The four panes of R Studio</a></li>
<li class="chapter" data-level="1.2.3" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-4-interacting-with-the-4-panes"><i class="fa fa-check"></i><b>1.2.3</b> Activity 4: Interacting with the 4 panes</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#customising-the-rstudio-look"><i class="fa fa-check"></i><b>1.3</b> Customising the RStudio look</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#functions"><i class="fa fa-check"></i><b>1.3.1</b> Functions</a></li>
<li class="chapter" data-level="1.3.2" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#objects"><i class="fa fa-check"></i><b>1.3.2</b> Objects</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#packages"><i class="fa fa-check"></i><b>1.4</b> Packages</a></li>
<li class="chapter" data-level="1.5" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#exploring-data"><i class="fa fa-check"></i><b>1.5</b> Exploring data</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#activity-8-playing-around-with-data"><i class="fa fa-check"></i><b>1.5.1</b> Activity 8: Playing around with data</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="a-first-lesson-about-r.html"><a href="a-first-lesson-about-r.html#getting-organised-r-projects"><i class="fa fa-check"></i><b>1.6</b> Getting organised: R Projects</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html"><i class="fa fa-check"></i><b>2</b> Making Maps in R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#a-quick-introduction-of-terms"><i class="fa fa-check"></i><b>2.1</b> A quick introduction of terms</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#geospatial-perspective---the-basics"><i class="fa fa-check"></i><b>2.1.1</b> Geospatial Perspective - The Basics</a></li>
<li class="chapter" data-level="2.1.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#summary"><i class="fa fa-check"></i><b>2.1.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#getting-some-spatial-data-to-put-on-a-map"><i class="fa fa-check"></i><b>2.2</b> Getting some spatial data to put on a map</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#find-some-relevant-data-to-show-obtaining-data-on-crime"><i class="fa fa-check"></i><b>2.2.1</b> Find some relevant data to show: obtaining data on crime</a></li>
<li class="chapter" data-level="2.2.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#activity-1-get-some-crime-data"><i class="fa fa-check"></i><b>2.2.2</b> Activity 1: Get some crime data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#from-dataframes-to-spatial-objects-finding-spatial-information-in-our-data"><i class="fa fa-check"></i><b>2.3</b> From dataframes to spatial objects: finding spatial information in our data</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#activity-2-find-the-spatial-data"><i class="fa fa-check"></i><b>2.3.1</b> Activity 2: Find the spatial data</a></li>
<li class="chapter" data-level="2.3.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-point"><i class="fa fa-check"></i><b>2.3.2</b> The point</a></li>
<li class="chapter" data-level="2.3.3" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-line"><i class="fa fa-check"></i><b>2.3.3</b> The line</a></li>
<li class="chapter" data-level="2.3.4" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#the-polygon"><i class="fa fa-check"></i><b>2.3.4</b> The polygon</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#putting-crime-on-the-map---simple-features"><i class="fa fa-check"></i><b>2.4</b> Putting crime on the map - simple features</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#mapping-points-with-sf"><i class="fa fa-check"></i><b>2.4.1</b> Mapping points with sf</a></li>
<li class="chapter" data-level="2.4.2" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#mapping-data-by-joining-it-to-sf-objects"><i class="fa fa-check"></i><b>2.4.2</b> Mapping data by joining it to sf objects</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="making-maps-in-r.html"><a href="making-maps-in-r.html#summary-1"><i class="fa fa-check"></i><b>2.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html"><i class="fa fa-check"></i><b>3</b> Thematic maps in R</a>
<ul>
<li class="chapter" data-level="3.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-1-spot-the-difference"><i class="fa fa-check"></i><b>3.1.1</b> Activity 1: Spot the difference</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#creating-thematic-maps"><i class="fa fa-check"></i><b>3.2</b> Creating thematic maps</a></li>
<li class="chapter" data-level="3.3" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#classification-systems-for-thematic-maps"><i class="fa fa-check"></i><b>3.3</b> Classification systems for thematic maps</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-2-comparing-classifications"><i class="fa fa-check"></i><b>3.3.1</b> Activity 2: Comparing classifications</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#using-graduated-symbols"><i class="fa fa-check"></i><b>3.4</b> Using graduated symbols</a></li>
<li class="chapter" data-level="3.5" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#mapping-rates-rather-than-counts"><i class="fa fa-check"></i><b>3.5</b> Mapping rates rather than counts</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-3-getting-population-data-from-the-census"><i class="fa fa-check"></i><b>3.5.1</b> Activity 3: Getting population data from the census</a></li>
<li class="chapter" data-level="3.5.2" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#activity-5-mapping-crime-rates"><i class="fa fa-check"></i><b>3.5.2</b> Activity 5: Mapping crime rates</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="thematic-maps-in-r.html"><a href="thematic-maps-in-r.html#summary-2"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html"><i class="fa fa-check"></i><b>4</b> Performing spatial operations in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#criminality-of-place"><i class="fa fa-check"></i><b>4.1</b> Criminality of place</a></li>
<li class="chapter" data-level="4.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#spatial-operations"><i class="fa fa-check"></i><b>4.2</b> Spatial operations</a></li>
<li class="chapter" data-level="4.3" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#download-some-boundary-data-for-relevant-wards"><i class="fa fa-check"></i><b>4.3</b> Download some boundary data for relevant wards</a></li>
<li class="chapter" data-level="4.4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-1-first-spatial-operation-union"><i class="fa fa-check"></i><b>4.4</b> Activity 1: First spatial operation: union</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#meet-a-new-format-of-shapefile-geojson"><i class="fa fa-check"></i><b>4.4.1</b> Meet a new format of shapefile: geojson</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#getting-open-data-from-the-city"><i class="fa fa-check"></i><b>4.5</b> Getting open data from the city</a></li>
<li class="chapter" data-level="4.6" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#what-is-geocoding-and-how-can-we-use-addresses-to-put-venues-on-the-map"><i class="fa fa-check"></i><b>4.6</b> What is geocoding and how can we use addresses to put venues on the map?</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-2-subsetting-using-pattern-matching"><i class="fa fa-check"></i><b>4.6.1</b> Activity 2: Subsetting using pattern matching</a></li>
<li class="chapter" data-level="4.6.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-3-pattern-matching-to-find-city-centre-premises"><i class="fa fa-check"></i><b>4.6.2</b> Activity 3: Pattern matching to find city centre premises</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#geocoding-from-an-address"><i class="fa fa-check"></i><b>4.7</b> Geocoding from an address</a></li>
<li class="chapter" data-level="4.8" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#making-interactive-maps-with-leaflet"><i class="fa fa-check"></i><b>4.8</b> Making interactive maps with leaflet</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-4-making-an-interactive-map"><i class="fa fa-check"></i><b>4.8.1</b> Activity 4: Making an interactive map</a></li>
<li class="chapter" data-level="4.8.2" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#coordinate-reference-systems-revisited"><i class="fa fa-check"></i><b>4.8.2</b> Coordinate reference systems revisited</a></li>
<li class="chapter" data-level="4.8.3" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-5-subset-points-to-those-within-a-polygon"><i class="fa fa-check"></i><b>4.8.3</b> Activity 5: Subset points to those within a polygon</a></li>
<li class="chapter" data-level="4.8.4" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-6-building-buffers"><i class="fa fa-check"></i><b>4.8.4</b> Activity 6: Building buffers</a></li>
<li class="chapter" data-level="4.8.5" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-7-counting-points-in-polygon"><i class="fa fa-check"></i><b>4.8.5</b> Activity 7: Counting Points in Polygon</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#activity-8-combo"><i class="fa fa-check"></i><b>4.9</b> Activity 8: Combo!</a></li>
<li class="chapter" data-level="4.10" data-path="performing-spatial-operations-in-r.html"><a href="performing-spatial-operations-in-r.html#summary-3"><i class="fa fa-check"></i><b>4.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html"><i class="fa fa-check"></i><b>5</b> More on thematic maps</a>
<ul>
<li class="chapter" data-level="5.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#pro-tip-do-i-need-to-install-this-package"><i class="fa fa-check"></i><b>5.1</b> Pro-tip: do I need to install this package?</a></li>
<li class="chapter" data-level="5.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#smoothing-rates-adjusting-for-small-sample-noise"><i class="fa fa-check"></i><b>5.2</b> Smoothing rates: adjusting for small sample noise</a></li>
<li class="chapter" data-level="5.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#binning-points"><i class="fa fa-check"></i><b>5.3</b> Binning points</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#the-binning-process"><i class="fa fa-check"></i><b>5.3.1</b> The Binning Process</a></li>
<li class="chapter" data-level="5.3.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#different-binning-techniques"><i class="fa fa-check"></i><b>5.3.2</b> Different Binning Techniques</a></li>
<li class="chapter" data-level="5.3.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-7-hexbinning"><i class="fa fa-check"></i><b>5.3.3</b> Activity 7: Hexbinning</a></li>
<li class="chapter" data-level="5.3.4" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-8-rectangular-binning"><i class="fa fa-check"></i><b>5.3.4</b> Activity 8: Rectangular binning</a></li>
<li class="chapter" data-level="5.3.5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#multivariate-binning"><i class="fa fa-check"></i><b>5.3.5</b> Multivariate binning</a></li>
<li class="chapter" data-level="5.3.6" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#benefits-of-binning"><i class="fa fa-check"></i><b>5.3.6</b> Benefits of Binning</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#a-note-of-caution-maup"><i class="fa fa-check"></i><b>5.4</b> A note of caution: MAUP</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#what-is-maup"><i class="fa fa-check"></i><b>5.4.1</b> What is MAUP?</a></li>
<li class="chapter" data-level="5.4.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#why-does-maup-matter"><i class="fa fa-check"></i><b>5.4.2</b> Why does MAUP matter?</a></li>
<li class="chapter" data-level="5.4.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#what-can-we-do"><i class="fa fa-check"></i><b>5.4.3</b> What can we do?</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#transforming-polygons"><i class="fa fa-check"></i><b>5.5</b> Transforming polygons</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#activity-9-cartograms"><i class="fa fa-check"></i><b>5.5.1</b> Activity 9: Cartograms</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#summary-4"><i class="fa fa-check"></i><b>5.6</b> Summary</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#binning"><i class="fa fa-check"></i><b>5.6.1</b> Binning</a></li>
<li class="chapter" data-level="5.6.2" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#maup"><i class="fa fa-check"></i><b>5.6.2</b> MAUP</a></li>
<li class="chapter" data-level="5.6.3" data-path="more-on-thematic-maps.html"><a href="more-on-thematic-maps.html#transforming-polygons-1"><i class="fa fa-check"></i><b>5.6.3</b> Transforming polygons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html"><i class="fa fa-check"></i><b>6</b> Studying spatial point patterns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#what-well-do-today"><i class="fa fa-check"></i><b>6.1</b> What we’ll do today</a></li>
<li class="chapter" data-level="6.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#getting-the-data"><i class="fa fa-check"></i><b>6.2</b> Getting the data</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-1-getting-the-data-into-spatstat-the-problem-with-duplicates"><i class="fa fa-check"></i><b>6.2.1</b> Activity 1: Getting the data into spatstat: the problem with duplicates</a></li>
<li class="chapter" data-level="6.2.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-2-inspecting-our-data-with-spatstat"><i class="fa fa-check"></i><b>6.2.2</b> Activity 2: Inspecting our data with spatstat</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#density-estimates"><i class="fa fa-check"></i><b>6.3</b> Density estimates</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-3-density-maps"><i class="fa fa-check"></i><b>6.3.1</b> Activity 3: Density maps</a></li>
<li class="chapter" data-level="6.3.2" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-4-adding-some-context"><i class="fa fa-check"></i><b>6.3.2</b> Activity 4: Adding some context</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#spatial-point-patterns-along-networks"><i class="fa fa-check"></i><b>6.4</b> Spatial point patterns along networks</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#activity-5-spatial-point-pattern-processes-along-networks"><i class="fa fa-check"></i><b>6.4.1</b> Activity 5: Spatial point pattern processes along networks</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="studying-spatial-point-patterns.html"><a href="studying-spatial-point-patterns.html#summary-5"><i class="fa fa-check"></i><b>6.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html"><i class="fa fa-check"></i><b>7</b> Global and local spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="7.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#get-data"><i class="fa fa-check"></i><b>7.1</b> Get data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#what-is-a-neighbour"><i class="fa fa-check"></i><b>7.1.1</b> What is a neighbour?</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#putting-neighbourness-in-our-analysis---constructing-a-spatial-weight-matrix"><i class="fa fa-check"></i><b>7.2</b> Putting ‘neighbourness’ in our analysis - constructing a spatial weight matrix</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-1-burglaries-in-manchester-city-centre-ward"><i class="fa fa-check"></i><b>7.2.1</b> Activity 1: Burglaries in Manchester City Centre ward</a></li>
<li class="chapter" data-level="7.2.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-2-manually-explore-neighbours"><i class="fa fa-check"></i><b>7.2.2</b> Activity 2: Manually explore neighbours</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#creating-a-list-of-neighbours"><i class="fa fa-check"></i><b>7.3</b> Creating a list of neighbours</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-3-creating-a-neighbour-list"><i class="fa fa-check"></i><b>7.3.1</b> Activity 3: Creating a neighbour list</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#generating-the-weight-matrix"><i class="fa fa-check"></i><b>7.4</b> Generating the weight matrix</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-4-building-a-spatial-weights-matrix"><i class="fa fa-check"></i><b>7.4.1</b> Activity 4: Building a spatial weights matrix</a></li>
<li class="chapter" data-level="7.4.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-5-row-standardised-spatial-weights-matrix"><i class="fa fa-check"></i><b>7.4.2</b> Activity 5: Row standardised spatial weights matrix</a></li>
<li class="chapter" data-level="7.4.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-6-spatial-weights-list"><i class="fa fa-check"></i><b>7.4.3</b> Activity 6: Spatial weights list</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#morans-i"><i class="fa fa-check"></i><b>7.5</b> Moran’s I</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-7-calculate-morans-i"><i class="fa fa-check"></i><b>7.5.1</b> Activity 7: Calculate Moran’s I</a></li>
<li class="chapter" data-level="7.5.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-8-moran-scatter-plot"><i class="fa fa-check"></i><b>7.5.2</b> Activity 8: Moran scatter plot</a></li>
<li class="chapter" data-level="7.5.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#a-note-the-rgeoda-and-sfweight-packages"><i class="fa fa-check"></i><b>7.5.3</b> A note: the <code>rgeoda</code> and <code>sfweight</code> packages</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#local-spatial-autocorrelation"><i class="fa fa-check"></i><b>7.6</b> Local spatial autocorrelation</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-9-get-data-and-weights-for-all-manchester"><i class="fa fa-check"></i><b>7.6.1</b> Activity 9: Get data and weights for all Manchester</a></li>
<li class="chapter" data-level="7.6.2" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#activity-10-exploring-a-local-indicator-of-spatial-association-local-morans-i."><i class="fa fa-check"></i><b>7.6.2</b> Activity 10: Exploring a Local Indicator of Spatial Association: Local Moran’s I.</a></li>
<li class="chapter" data-level="7.6.3" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#creating-a-lisa-map"><i class="fa fa-check"></i><b>7.6.3</b> Creating a LISA map</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="global-and-local-spatial-autocorrelation.html"><a href="global-and-local-spatial-autocorrelation.html#summary-6"><i class="fa fa-check"></i><b>7.7</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html"><i class="fa fa-check"></i><b>8</b> Regression analysis (a refresher)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#introduction-2"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-1-familiarise-yourself-with-the-data"><i class="fa fa-check"></i><b>8.1.1</b> Activity 1: Familiarise yourself with the data</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#motivating-regression"><i class="fa fa-check"></i><b>8.2</b> Motivating regression</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-2-guessing-games"><i class="fa fa-check"></i><b>8.2.1</b> Activity 2: Guessing games</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-a-simple-regression-model"><i class="fa fa-check"></i><b>8.3</b> Fitting a simple regression model</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-3-regressing-homicide-rate-on-deprivation-score"><i class="fa fa-check"></i><b>8.3.1</b> Activity 3: Regressing homicide rate on deprivation score</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#residuals-revisited-r-squared"><i class="fa fa-check"></i><b>8.4</b> Residuals revisited: R squared</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-4-residuals-for-our-homicide-rate-model"><i class="fa fa-check"></i><b>8.4.1</b> Activity 4: Residuals for our homicide rate model</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#inference-with-regression"><i class="fa fa-check"></i><b>8.5</b> Inference with regression</a></li>
<li class="chapter" data-level="8.6" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-regression-with-categorical-predictors"><i class="fa fa-check"></i><b>8.6</b> Fitting regression with categorical predictors</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-5-homicide-rates-in-the-south-v-the-north"><i class="fa fa-check"></i><b>8.6.1</b> Activity 5: Homicide rates in the South v the North</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#motivating-multiple-regression"><i class="fa fa-check"></i><b>8.7</b> Motivating multiple regression</a></li>
<li class="chapter" data-level="8.8" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#fitting-and-interpreting-a-multiple-regression-model"><i class="fa fa-check"></i><b>8.8</b> Fitting and interpreting a multiple regression model</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-6-better-explaining-homicide-rates"><i class="fa fa-check"></i><b>8.8.1</b> Activity 6: Better explaining homicide rates</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#presenting-your-regression-results."><i class="fa fa-check"></i><b>8.9</b> Presenting your regression results.</a>
<ul>
<li class="chapter" data-level="8.9.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-7-plotting-your-results"><i class="fa fa-check"></i><b>8.9.1</b> Activity 7: Plotting your results</a></li>
</ul></li>
<li class="chapter" data-level="8.10" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#rescaling-input-variables-to-assist-interpretation"><i class="fa fa-check"></i><b>8.10</b> Rescaling input variables to assist interpretation</a></li>
<li class="chapter" data-level="8.11" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#testing-conditional-hypothesis-interactions"><i class="fa fa-check"></i><b>8.11</b> Testing conditional hypothesis: interactions</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#activity-8-interaction-effects"><i class="fa fa-check"></i><b>8.11.1</b> Activity 8: Interaction effects</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#model-building-and-variable-selection"><i class="fa fa-check"></i><b>8.12</b> Model building and variable selection</a></li>
<li class="chapter" data-level="8.13" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#regression-assumptions"><i class="fa fa-check"></i><b>8.13</b> Regression assumptions</a></li>
<li class="chapter" data-level="8.14" data-path="regression-analysis-a-refresher.html"><a href="regression-analysis-a-refresher.html#summary-7"><i class="fa fa-check"></i><b>8.14</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html"><i class="fa fa-check"></i><b>9</b> Spatial regression models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#introduction-3"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#looking-at-the-residuals-and-testing-for-spatial-autocorrelation-in-regression"><i class="fa fa-check"></i><b>9.2</b> Looking at the residuals and testing for spatial autocorrelation in regression</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-1-a-non-spatial-regression-on-spatial-data---listen-to-the-residuals"><i class="fa fa-check"></i><b>9.2.1</b> Activity 1: A non-spatial regression on spatial data - listen to the residuals</a></li>
<li class="chapter" data-level="9.2.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-2-spatial-autocorrelation-again"><i class="fa fa-check"></i><b>9.2.2</b> Activity 2: Spatial autocorrelation (again)</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#what-to-do-now"><i class="fa fa-check"></i><b>9.3</b> What to do now?</a></li>
<li class="chapter" data-level="9.4" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#spatial-regimes"><i class="fa fa-check"></i><b>9.4</b> Spatial Regimes</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-3-assessing-spatial-regimes-using-residuals"><i class="fa fa-check"></i><b>9.4.1</b> Activity 3: Assessing spatial regimes using residuals</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#lagrange-multipliers"><i class="fa fa-check"></i><b>9.5</b> Lagrange multipliers</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-4-lagrange-multiplier-tests"><i class="fa fa-check"></i><b>9.5.1</b> Activity 4: Lagrange multiplier tests</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-and-interpreting-a-spatially-lagged-model"><i class="fa fa-check"></i><b>9.6</b> Fitting and interpreting a spatially lagged model</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-5-spatial-lag-model"><i class="fa fa-check"></i><b>9.6.1</b> Activity 5: Spatial lag model</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#fitting-an-interpreting-a-spatial-error-model"><i class="fa fa-check"></i><b>9.7</b> Fitting an interpreting a spatial error model</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-6-spatial-error-model"><i class="fa fa-check"></i><b>9.7.1</b> Activity 6: Spatial error model</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#time-matters"><i class="fa fa-check"></i><b>9.8</b> Time matters!</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-7-small-multiples"><i class="fa fa-check"></i><b>9.8.1</b> Activity 7: Small multiples</a></li>
<li class="chapter" data-level="9.8.2" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#activity-8-animations"><i class="fa fa-check"></i><b>9.8.2</b> Activity 8: Animations</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="spatial-regression-models.html"><a href="spatial-regression-models.html#summary-8"><i class="fa fa-check"></i><b>9.9</b> Summary</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Crime Mapping in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="thematic-maps-in-r" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Thematic maps in R<a href="thematic-maps-in-r.html#thematic-maps-in-r" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="introduction-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction<a href="thematic-maps-in-r.html#introduction-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Last week we showed you fairly quickly how to create maps by understanding how data may have spatial elements, and how that can be linked to geometries.</p>
<p>This week we will get to know how to think about thematic maps, and how to apply your learning to creating your own maps of this variety. In our lecture videos this week we discuss in detail issues with choropleth maps. So the focus of today’s lab is going to be around thematic maps and some of the choices we discussed.</p>
<p>We will also introduce faceting and <strong>small multiples</strong>, which is a format for comparing the geographical distribution of different social phenomena. For this session we will be using the spatial object that you created last week and complement it with additional information from the census. So first of all you will have to rerun the code you used to create the <em>manchester_lsoa</em> <code>sf</code> object. Apart from doing so, you want to start your session loading the libraries you know for sure you will need:</p>
<ul>
<li><code>dplyr</code></li>
<li><code>janitor</code></li>
<li><code>readr</code></li>
<li><code>sf</code></li>
<li><code>shinyjs</code></li>
<li><code>tmap</code></li>
</ul>
<p>You may not remember all of what you did to generate that file so let’s not waste time and just cut and paste from below (but try to remember what each of the lines of code is doing and if you are not clear look at the notes from last week). Imagine you had to do all of this again by pointing and clicking in a graphical user interface rather than just sending the code to the console! As you will see time and time again, code in the end is a much more efficient way of talking to a computer.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="thematic-maps-in-r.html#cb110-1" tabindex="-1"></a>crimes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/2019-06-greater-manchester-street.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Rows: 32058 Columns: 12
## ── Column specification ────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (9): Crime ID, Month, Reported by, Falls within, Location, LSOA code, LS...
## dbl (2): Longitude, Latitude
## lgl (1): Context
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="thematic-maps-in-r.html#cb112-1" tabindex="-1"></a><span class="co">#The following assumes you have a subdirectory called BoundaryData in your data folder, if not then you will need to change to the &#39;pathfile&#39; where you store your LSOA shapefile. </span></span>
<span id="cb112-2"><a href="thematic-maps-in-r.html#cb112-2" tabindex="-1"></a>shp_name <span class="ot">&lt;-</span> <span class="st">&quot;data/BoundaryData/england_lsoa_2011.shp&quot;</span></span>
<span id="cb112-3"><a href="thematic-maps-in-r.html#cb112-3" tabindex="-1"></a>manchester_lsoa <span class="ot">&lt;-</span> <span class="fu">st_read</span>(shp_name)</span>
<span id="cb112-4"><a href="thematic-maps-in-r.html#cb112-4" tabindex="-1"></a></span>
<span id="cb112-5"><a href="thematic-maps-in-r.html#cb112-5" tabindex="-1"></a><span class="co">#Alternatively, you can download the &#39;LSOA shapefile&#39; from where we saved the data. </span></span>
<span id="cb112-6"><a href="thematic-maps-in-r.html#cb112-6" tabindex="-1"></a><span class="co">#Important! note that I store it in on my &#39;Data&#39; folder You HAVE TO change that if needed.</span></span>
<span id="cb112-7"><a href="thematic-maps-in-r.html#cb112-7" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://www.dropbox.com/s/h5c1okn4m6t3rqe/BoundaryData.zip?dl=1&quot;</span> , </span>
<span id="cb112-8"><a href="thematic-maps-in-r.html#cb112-8" tabindex="-1"></a>              <span class="at">destfile=</span><span class="st">&quot;data/BoundaryData.zip&quot;</span>, <span class="co"># change to your local directory</span></span>
<span id="cb112-9"><a href="thematic-maps-in-r.html#cb112-9" tabindex="-1"></a>              <span class="at">mode =</span> <span class="st">&quot;wb&quot;</span>) <span class="co"># write binary data</span></span>
<span id="cb112-10"><a href="thematic-maps-in-r.html#cb112-10" tabindex="-1"></a></span>
<span id="cb112-11"><a href="thematic-maps-in-r.html#cb112-11" tabindex="-1"></a><span class="co">#Important! note that I extract file to the data/BoundaryData folder. You HAVE TO change exdir (the directory to extract files to)</span></span>
<span id="cb112-12"><a href="thematic-maps-in-r.html#cb112-12" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">&quot;data/BoundaryData.zip&quot;</span>, <span class="at">exdir =</span> <span class="st">&quot;data&quot;</span>)</span>
<span id="cb112-13"><a href="thematic-maps-in-r.html#cb112-13" tabindex="-1"></a>manchester_lsoa <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/BoundaryData/england_lsoa_2011.shp&quot;</span>)</span></code></pre></div>
<p>Once you import the data, let’s count the number of crimes in each LSOA units like what we did in the week 2.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="thematic-maps-in-r.html#cb113-1" tabindex="-1"></a><span class="co">#count the number of crimes in each LSOA</span></span>
<span id="cb113-2"><a href="thematic-maps-in-r.html#cb113-2" tabindex="-1"></a>crimes_per_lsoa <span class="ot">&lt;-</span> crimes <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="thematic-maps-in-r.html#cb113-3" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb113-4"><a href="thematic-maps-in-r.html#cb113-4" tabindex="-1"></a>  <span class="fu">select</span>(lsoa_code) <span class="sc">%&gt;%</span></span>
<span id="cb113-5"><a href="thematic-maps-in-r.html#cb113-5" tabindex="-1"></a>  <span class="fu">group_by</span>(lsoa_code) <span class="sc">%&gt;%</span></span>
<span id="cb113-6"><a href="thematic-maps-in-r.html#cb113-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>())</span>
<span id="cb113-7"><a href="thematic-maps-in-r.html#cb113-7" tabindex="-1"></a><span class="co">#merge the crime count with the LSOA file</span></span>
<span id="cb113-8"><a href="thematic-maps-in-r.html#cb113-8" tabindex="-1"></a>manchester_crime_lsoa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(manchester_lsoa, crimes_per_lsoa, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;code&quot;</span><span class="ot">=</span><span class="st">&quot;lsoa_code&quot;</span>))</span>
<span id="cb113-9"><a href="thematic-maps-in-r.html#cb113-9" tabindex="-1"></a></span>
<span id="cb113-10"><a href="thematic-maps-in-r.html#cb113-10" tabindex="-1"></a><span class="co">#Any LSOA units with no crime counted (E01005248 and E01005278) are treated as NA, so replace this as 0</span></span>
<span id="cb113-11"><a href="thematic-maps-in-r.html#cb113-11" tabindex="-1"></a><span class="co">#However, this process you need to carefully proceed. In some context, you could consider &#39;unknown&#39; or &#39;missing&#39; not 0</span></span>
<span id="cb113-12"><a href="thematic-maps-in-r.html#cb113-12" tabindex="-1"></a>manchester_crime_lsoa<span class="sc">$</span>count[<span class="fu">is.na</span>(manchester_crime_lsoa<span class="sc">$</span>count)] <span class="ot">&lt;-</span> <span class="dv">0</span></span></code></pre></div>
<p>You may not want to have to go through this process all the time. One thing you could do is to save the <em>manchester_lsoa</em> object as a physical file in your machine. You can use the <code>st_write()</code> function from the <code>sf</code> package to do this. If we want to write into a shapefile format we would do as shown below:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="thematic-maps-in-r.html#cb114-1" tabindex="-1"></a><span class="fu">st_write</span>(manchester_crime_lsoa, <span class="st">&quot;data/BoundaryData/manchester_crime_lsoa.shp&quot;</span>)</span></code></pre></div>
<p>Notice how four files have appeared in your working directory, in your “BoundaryData”” subdirectory or whatever you called it. Remember what we said last week about shapefiles, there are a collection of files that need to be kept together.</p>
<p>If you wanted to bring this shapefile back into R at any future point, you would only need to use the <code>st_read()</code> function.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="thematic-maps-in-r.html#cb115-1" tabindex="-1"></a>manchester_crime_lsoa <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/BoundaryData/manchester_crime_lsoa.shp&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `manchester_crime_lsoa&#39; from data source 
##   `/Users/user/Desktop/resquant/crime_mapping_textbook/data/BoundaryData/manchester_crime_lsoa.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 295 features and 5 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 378833.2 ymin: 382620.6 xmax: 390350.2 ymax: 405357.1
## Projected CRS: OSGB36 / British National Grid</code></pre>
<div id="activity-1-spot-the-difference" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Activity 1: Spot the difference<a href="thematic-maps-in-r.html#activity-1-spot-the-difference" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before we carry on, can you tell what is different between <em>manchester_lsoa.shp</em> and <em>manchester_crime_lsoa.shp</em> that you now have saved for working with? Discuss in your groups.</p>
</div>
</div>
<div id="creating-thematic-maps" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Creating thematic maps<a href="thematic-maps-in-r.html#creating-thematic-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Today we are going to introduce the <code>tmap</code> package. This package was developed to easily produce thematic maps. It is inspired by the <code>ggplot2</code> package and the layered grammar of graphics. It was written by Martjin Tennekes a Dutch data scientist. There are a number of <a href="https://cran.r-project.org/web/packages/tmap/index.html">vignettes in the CRAN repository</a> and the <a href="https://github.com/mtennekes/tmap">GitHub repo for this package</a> that you can explore. GitHub is a collaborative website used by software developers and data scientist, also contains a useful <em>readme</em> section with additional resources to familiarise yourself with this package. Each map can be plotted as a static map (<em>plot mode</em>) and shown interactively (<em>view mode</em>) as we briefly saw last week. We will start by focusing on static maps.</p>
<p>Every time you use this package you will need a line of code that specifies the spatial object you will be using. Although originally developed to handle <code>sp</code> objects only, it now also has support for <code>sf</code> objects. For specifying the spatial object we use the <code>tm_shape()</code> function and inside we specify the name of the spatial object we are using. On its own, this will do nothing apparent. No map will be created. We need to add additional functions to specify what we are doing with that spatial object. If you try to run this line on its own, you’ll get an error telling you you must “Error: no layer elements defined after tm_shape”.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="thematic-maps-in-r.html#cb117-1" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb117-2"><a href="thematic-maps-in-r.html#cb117-2" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa)</span></code></pre></div>
<p>The main plotting method consists of elements that we can add. The first element is the <code>tm_shape()</code> function specifying the spatial object, and then we can add a series of elements specifying layers in the visualisation. They can include polygons, symbols, polylines, raster, and text labels as base layers. We will add a polygon using <code>tm_polygon()</code>. As noted, with <code>tmap</code> you can produce both static and interactive maps. The interactive maps rely on <code>leaflet</code>. You can control whether the map is static or interactive with the <code>tmap_mode()</code> function. If you want a static map you pass <code>plot</code> as an argument, if you want an interactive map you pass <code>view</code> as an argument. Let’s create a static map first.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="thematic-maps-in-r.html#cb118-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<pre><code>## ℹ tmap modes &quot;plot&quot; - &quot;view&quot;
## ℹ toggle with `tmap::ttm()`</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="thematic-maps-in-r.html#cb120-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb120-2"><a href="thematic-maps-in-r.html#cb120-2" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Given that we are not passing any additional arguments all we are getting is a map with the shape of the geographies that we are representing, the census LSOAs for Manchester city. We can, however, ask R to produce a choropleth map by mapping the values of a variable in our data table using colour. In tmap we need to denote our variables between quotes. The first argument we pass then would be the name of the variable we want to visualise. If you remember we have a count for crimes (“count”), so let’s visualise that by creating a thematic map.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="thematic-maps-in-r.html#cb121-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb121-2"><a href="thematic-maps-in-r.html#cb121-2" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p>We have been using <code>tm_polygons()</code> but we can also add the elements of a polygon map using different functions that break down what we represent here. In the map above you see the polygons have a dual representation, the borders are represented by lines and the colour is mapped to the intensity of the quantitative variable we are representing. With darker colours representing more of the variable, the areas with more crimes. Instead of using <code>tm_polygon()</code> we can use the related functions <code>tm_fill()</code>, for the colour inside the polygons, and <code>tm_borders()</code>, for the aesthetics representing the border of the polygons. Say we find the borders distracting and we want to set them to be transparent. In that case we could just use <code>tm_fill()</code>.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="thematic-maps-in-r.html#cb122-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb122-2"><a href="thematic-maps-in-r.html#cb122-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>As you can see here, the look is a bit cleaner. We don’t need to get rid of the borders completely. Perhaps we want to make them a bit more translucent. We could do that by adding the border element but making the drawing of the borders less pronounced.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="thematic-maps-in-r.html#cb123-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb123-2"><a href="thematic-maps-in-r.html#cb123-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-3"><a href="thematic-maps-in-r.html#cb123-3" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col_alpha =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<p>The alpha parameter that we are inserting within <code>tm_borders()</code> controls the transparency of the borders, we can go from 0 (totally transparent) to 1 (not transparent). You can play around with this value and see the results.</p>
<p>Notice in the last few maps we did not have to specify whether we wanted the map to be static or interactive. When you use <code>tmap</code>, R will remember the mode you want to use. So once you specify <code>tmap_mode("plot")</code>, all the subsequent maps will be static. It is only when you want to change this behaviour that you would need another <code>tmap_mode</code> call.</p>
<p>Notice as well that the legend in this map is (a) not very informative and (b) located in a place that is less than optimal, since it covers part of the map. We can add a title within the <code>tm_title()</code> to clarify what count is and we can use the <code>tm_legend()</code> function to control the appearance of the legend. This later function <code>tm_legend()</code> allows you to think about many of the more general cosmetics of the map.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="thematic-maps-in-r.html#cb124-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb124-2"><a href="thematic-maps-in-r.html#cb124-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, </span>
<span id="cb124-3"><a href="thematic-maps-in-r.html#cb124-3" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Crime counts&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title.size =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb124-4"><a href="thematic-maps-in-r.html#cb124-4" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col_alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb124-5"><a href="thematic-maps-in-r.html#cb124-5" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="at">text =</span> <span class="st">&quot;Crime in Manchester City, June/2019&quot;</span>, <span class="at">size =</span> <span class="fl">0.7</span> )</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
<p>We can also change the cstyle of the maps by making them more friendly to colour blind people, or to see what they will look like printed by using the “bw” theme (black and white).</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="thematic-maps-in-r.html#cb125-1" tabindex="-1"></a>current_style <span class="ot">&lt;-</span> <span class="fu">tmap_style</span>(<span class="st">&quot;bw&quot;</span>)</span></code></pre></div>
<pre><code>## style set to &quot;bw&quot;</code></pre>
<pre><code>## other available styles are: &quot;white&quot; (tmap default), &quot;gray&quot;, &quot;natural&quot;, &quot;cobalt&quot;, &quot;albatross&quot;, &quot;beaver&quot;, &quot;classic&quot;, &quot;watercolor&quot;</code></pre>
<pre><code>## tmap v3 styles: &quot;v3&quot; (tmap v3 default), &quot;gray_v3&quot;, &quot;natural_v3&quot;, &quot;cobalt_v3&quot;, &quot;albatross_v3&quot;, &quot;beaver_v3&quot;, &quot;bw_v3&quot;, &quot;classic_v3&quot;, &quot;watercolor_v3&quot;</code></pre>
<p>See how the map changes.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="thematic-maps-in-r.html#cb129-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb129-2"><a href="thematic-maps-in-r.html#cb129-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, </span>
<span id="cb129-3"><a href="thematic-maps-in-r.html#cb129-3" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Crime counts&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="at">title.size =</span> <span class="fl">0.8</span>)) <span class="sc">+</span></span>
<span id="cb129-4"><a href="thematic-maps-in-r.html#cb129-4" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col_alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb129-5"><a href="thematic-maps-in-r.html#cb129-5" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="at">text =</span> <span class="st">&quot;Crime in Manchester City, June/2019&quot;</span>, <span class="at">size =</span> <span class="fl">0.7</span> )</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>Let’s go back to the default for now (“white”):</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="thematic-maps-in-r.html#cb130-1" tabindex="-1"></a>current_style <span class="ot">&lt;-</span> <span class="fu">tmap_style</span>(<span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<pre><code>## style set to &quot;white&quot; (tmap default)</code></pre>
<pre><code>## other available styles are: &quot;gray&quot;, &quot;natural&quot;, &quot;cobalt&quot;, &quot;albatross&quot;, &quot;beaver&quot;, &quot;bw&quot;, &quot;classic&quot;, &quot;watercolor&quot;</code></pre>
<pre><code>## tmap v3 styles: &quot;v3&quot; (tmap v3 default), &quot;gray_v3&quot;, &quot;natural_v3&quot;, &quot;cobalt_v3&quot;, &quot;albatross_v3&quot;, &quot;beaver_v3&quot;, &quot;bw_v3&quot;, &quot;classic_v3&quot;, &quot;watercolor_v3&quot;</code></pre>
</div>
<div id="classification-systems-for-thematic-maps" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Classification systems for thematic maps<a href="thematic-maps-in-r.html#classification-systems-for-thematic-maps" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In thematic mapping, you have to make some key decisions, the most important one being how to display your data. When mapping a quantitative variable, we have to “bin” this variable into groups. For example in the map we made below, the default binning applied was to display LSOAs grouped into those with 1 -200, 201-400, 401-600 and 601-800 crimes. But why these? How were these groupings decided upon?</p>
<p>The quantitative information, being directly measured (e.g. total population) or derived (e.g. population density), is usually classified before its symbolization in a thematic map. Theoretically, accurate classes that best reflect the distributional character of the data set can be calculated.</p>
<p><strong>The equal interval</strong> (or equal step) classification method divides the range of attribute values into equally sized classes. What this means is that the values are divided into equal groups. This approach is best for continuous data.</p>
<p><strong>The quantile map</strong> bin the same count of features into each of its classes. This classification method places equal numbers of observations into each class. This method is best for data that is evenly distributed across its range.</p>
<p><strong>The natural breaks (or Jenks)</strong> classification method utilizes an algorithm to group values in classes that are separated by distinct break points. It is an optimisation method which takes an iterative approach to its groupings to achieve least variation within each class. This method is best used with data that is unevenly distributed but not skewed toward either end of the distribution.</p>
<p><strong>The standard deviation</strong> map uses the standard deviation (standardised measure of observations’ deviation from the mean) to bin the observations into classes. This classification method forms each class by adding and subtracting the standard deviation from the mean of the dataset. It is best suited to be used with data that conforms to a normal distribution.</p>
<p>The above should be familiar from your reading, but if you would like another angle I recommend a browse of <a href="https://gisgeography.com/choropleth-maps-data-classification/">this guide</a> which has some nice visualisations.</p>
<div id="activity-2-comparing-classifications" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Activity 2: Comparing classifications<a href="thematic-maps-in-r.html#activity-2-comparing-classifications" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For comparing the effects of using different methods we can use small multiples. Small multiples is simply a way of reproducing side by sides similar maps for comparative purposes. To be more precise small multiples are <em>sets of charts of the same type, with the same scale, presented together at a small size and with minimal detail, usually in a grid of some kind</em>. The term was at least popularized by Edward Tufte, appearing first in his <em>Visual Display of Quantitative Information</em> in 1983.</p>
<p>There are different ways of creating small multiples with <code>tmap</code> as you could see in the vignettes for the package, some of which are quicker but a bit more restricted. Here we are going to use <code>tmap_arrange()</code>. With <code>tmap_arrange()</code> first we need to create the maps we want and then we arrange them together.</p>
<p>Let’s make four maps, each one using a different classification method: Equal interval, Quantile, Natural breaks (Jenks), and Standard Deviation.</p>
<p>For each map, instead of visualising them one by one, just assign them to a new object. Let’s call them <em>map1</em>, <em>map2</em>, <em>map3</em> and <em>map4</em>.</p>
<p>So let’s make <em>map1</em>. This will create a thematic map using equal intervals:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="thematic-maps-in-r.html#cb134-1" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span>  <span class="co"># Specify spatial object</span></span>
<span id="cb134-2"><a href="thematic-maps-in-r.html#cb134-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, <span class="co"># Define fill variable</span></span>
<span id="cb134-3"><a href="thematic-maps-in-r.html#cb134-3" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">style=</span><span class="st">&quot;equal&quot;</span>), <span class="co"># Define classification</span></span>
<span id="cb134-4"><a href="thematic-maps-in-r.html#cb134-4" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Equal&quot;</span>,        <span class="co"># Legend title</span></span>
<span id="cb134-5"><a href="thematic-maps-in-r.html#cb134-5" tabindex="-1"></a>                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), <span class="co"># Legend position</span></span>
<span id="cb134-6"><a href="thematic-maps-in-r.html#cb134-6" tabindex="-1"></a>                                  <span class="at">text.size =</span> <span class="fl">0.5</span>, <span class="co"># Legend text size</span></span>
<span id="cb134-7"><a href="thematic-maps-in-r.html#cb134-7" tabindex="-1"></a>                                  <span class="at">title.size =</span> <span class="fl">0.7</span>))    <span class="co">#Legend title size</span></span></code></pre></div>
<p>Now create <em>map2</em>, with the jenks method often preferred by geographers:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="thematic-maps-in-r.html#cb135-1" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span>  <span class="co"># Specify spatial object</span></span>
<span id="cb135-2"><a href="thematic-maps-in-r.html#cb135-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, </span>
<span id="cb135-3"><a href="thematic-maps-in-r.html#cb135-3" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">style=</span><span class="st">&quot;jenks&quot;</span>), </span>
<span id="cb135-4"><a href="thematic-maps-in-r.html#cb135-4" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Jenks&quot;</span>, </span>
<span id="cb135-5"><a href="thematic-maps-in-r.html#cb135-5" tabindex="-1"></a>                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>), </span>
<span id="cb135-6"><a href="thematic-maps-in-r.html#cb135-6" tabindex="-1"></a>                                  <span class="at">text.size =</span> <span class="fl">0.5</span>, </span>
<span id="cb135-7"><a href="thematic-maps-in-r.html#cb135-7" tabindex="-1"></a>                                  <span class="at">title.size =</span> <span class="fl">0.7</span>))   </span></code></pre></div>
<p>Now create <em>map3</em>, with the quantile method often preferred by epidemiologists:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="thematic-maps-in-r.html#cb136-1" tabindex="-1"></a>map3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span></span>
<span id="cb136-2"><a href="thematic-maps-in-r.html#cb136-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, </span>
<span id="cb136-3"><a href="thematic-maps-in-r.html#cb136-3" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">style=</span><span class="st">&quot;quantile&quot;</span>), </span>
<span id="cb136-4"><a href="thematic-maps-in-r.html#cb136-4" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Quantile&quot;</span>, </span>
<span id="cb136-5"><a href="thematic-maps-in-r.html#cb136-5" tabindex="-1"></a>                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb136-6"><a href="thematic-maps-in-r.html#cb136-6" tabindex="-1"></a>                                  <span class="at">text.size =</span> <span class="fl">0.5</span>, </span>
<span id="cb136-7"><a href="thematic-maps-in-r.html#cb136-7" tabindex="-1"></a>                                  <span class="at">title.size =</span> <span class="fl">0.7</span>)) </span></code></pre></div>
<p>This is neat as you can specify many things, for example the number of groups to split your data into.</p>
<p>And finally make <em>map4</em>, standard deviation map, which maps the values of our variable to distance to the mean value.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="thematic-maps-in-r.html#cb137-1" tabindex="-1"></a>map4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span></span>
<span id="cb137-2"><a href="thematic-maps-in-r.html#cb137-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;count&quot;</span>, </span>
<span id="cb137-3"><a href="thematic-maps-in-r.html#cb137-3" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">style=</span><span class="st">&quot;sd&quot;</span>), </span>
<span id="cb137-4"><a href="thematic-maps-in-r.html#cb137-4" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">&quot;Standard </span><span class="sc">\n</span><span class="st">Deviation&quot;</span>, </span>
<span id="cb137-5"><a href="thematic-maps-in-r.html#cb137-5" tabindex="-1"></a>                                  <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb137-6"><a href="thematic-maps-in-r.html#cb137-6" tabindex="-1"></a>                                  <span class="at">text.size =</span> <span class="fl">0.5</span>, </span>
<span id="cb137-7"><a href="thematic-maps-in-r.html#cb137-7" tabindex="-1"></a>                                  <span class="at">title.size =</span> <span class="fl">0.7</span>)) </span></code></pre></div>
<p>Notice that we are not plotting the maps, we are storing them into R objects (map1 to map4). This way they are saved, and you can call them later, which is what we need in order to plot them together using the <code>tmap_arrange()</code> function.</p>
<p>So if you wanted to map just <em>map3</em> for example, all you need to do, is call the map3 object. Like so:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="thematic-maps-in-r.html#cb138-1" tabindex="-1"></a>map3</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>But now we will plot all 4 maps together, arranged using the <code>tmap_arrange()</code> function. Like so:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="thematic-maps-in-r.html#cb139-1" tabindex="-1"></a><span class="co">#And now we deploy tmap_arrange to plot these maps together</span></span>
<span id="cb139-2"><a href="thematic-maps-in-r.html#cb139-2" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1, map2, map3, map4) </span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>There are some other classification methods built into tmap which you can experiment with if you’d like. Your discrete gradient options are “cat”, “fixed”, “sd”, “equal”, “pretty”, “quantile”, “kmeans”, “hclust”, “bclust”, “fisher”, “jenks”, “dpih”, “headtails”, and “log10_pretty”. A numeric variable is processed as a categorical variable when using “cat”, i.e. each unique value will correspond to a distinct category.</p>
<p>Taken from the help file we can find more information about these, for example the “kmeans” style uses kmeans clustering technique (a form of unsupervised statistical learning) to generate the breaks. The “hclust” style uses hclust to generate the breaks using hierarchical clustering and the “bclust” style uses bclust to generate the breaks using bagged clustering. These approaches are outisde the scope of what we cover, but just keep in mind that there are many different ways to classify your data, and you must think carefully about the choice you make, as it may affect your readers’ conclusions from your map.</p>
</div>
</div>
<div id="using-graduated-symbols" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Using graduated symbols<a href="thematic-maps-in-r.html#using-graduated-symbols" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some of the literature on thematic cartography highlights how counts, like the ones above, are best represented using graduated symbols rather than choropleth maps (using colour, as we did above). So let’s try to go for a more appropriate representation. In <code>tmap</code> you can use tm_symbols for this. We will also use <code>tm_borders</code> to provide some context.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="thematic-maps-in-r.html#cb140-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb140-2"><a href="thematic-maps-in-r.html#cb140-2" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>First thing you see is that we loose the context (provided by the polygon borders) that we had earlier. The <code>border.lwd</code> argument set to NA in the <code>tm_symbols()</code> is asking R not to draw a border to the circles. Whereas <code>tm_borders()</code> brings back a layer with the borders of the polygons representing the different LSOAs in Manchester city. Notice how I am modifying the transparency of the borders with the <code>col_alpha</code> parameter.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="thematic-maps-in-r.html#cb141-1" tabindex="-1"></a><span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span>                         <span class="co">#use tm_shape function to specify spatial object</span></span>
<span id="cb141-2"><a href="thematic-maps-in-r.html#cb141-2" tabindex="-1"></a>  <span class="fu">tm_bubbles</span>(<span class="st">&quot;count&quot;</span>, <span class="at">lwd =</span> <span class="cn">NA</span>) <span class="sc">+</span>              <span class="co">#use tm_bubbles to add the bubble visualisation, but set the &#39;border.lwd&#39; parameter to NA, meaning no symbol borders are drawn</span></span>
<span id="cb141-3"><a href="thematic-maps-in-r.html#cb141-3" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col_alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span>                           <span class="co">#add the LSOA border outlines using tm_borders, but set their transparency using the cl_alpha parameter (0 is totally transparent, 1 is not at all)</span></span>
<span id="cb141-4"><a href="thematic-maps-in-r.html#cb141-4" tabindex="-1"></a>  <span class="fu">tm_layout</span>(</span>
<span id="cb141-5"><a href="thematic-maps-in-r.html#cb141-5" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb141-6"><a href="thematic-maps-in-r.html#cb141-6" tabindex="-1"></a>    <span class="co">#use tm_layout to make the legend look nice</span></span>
<span id="cb141-7"><a href="thematic-maps-in-r.html#cb141-7" tabindex="-1"></a>    <span class="at">legend.title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb141-8"><a href="thematic-maps-in-r.html#cb141-8" tabindex="-1"></a>    <span class="at">legend.text.size =</span> <span class="fl">0.5</span></span>
<span id="cb141-9"><a href="thematic-maps-in-r.html#cb141-9" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
</div>
<div id="mapping-rates-rather-than-counts" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Mapping rates rather than counts<a href="thematic-maps-in-r.html#mapping-rates-rather-than-counts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In much of our readings we have now seen the importance to map rates rather than counts of things, and that is for the simple reason that population is not equally distributed in space. That means that if we do not account for how many people are somewhere, we end up mapping population size rather than our topic of interest. As always, there is a relevant xkcd for that:</p>
<p><img src="https://imgs.xkcd.com/comics/heatmap.png" alt="https://xkcd.com/1138/" />
In specific to crime mapping, there is an ongoing issue of the <em>denominators dilemma</em> which has been cropping up in your reading. This is concerned with choosing the most appropriate measure for calculating crime rates. The best measure is one which captures opportunities. You read about some approaches to capturing ambient population for example to estimate risk for on-street crimes. Whatever denominator you choose, you will usually want to make a case as to why that is the best representation of the opportunities for the crime type you’re interested in.</p>
<div id="activity-3-getting-population-data-from-the-census" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Activity 3: Getting population data from the census<a href="thematic-maps-in-r.html#activity-3-getting-population-data-from-the-census" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Last week you learned how to obtain crime data from the police UK website and you also developed the skills to obtain shapefiles with the boundaries for the UK census geographies. Specifically you learnt how to obtain LSOAs boundaries. Then we taught you how to join these data tables using <code>dplyr</code>. If you open your <em>manchester_lsoa</em> object you will see that at the moment you only have one field in this dataframe providing you with statistical information. However, there is a great deal of additional information that you could add to these data frame. Given that you are using census geographies you could add to it all kind of socio demographic variables available from the census.</p>
<p>The UK census data is available through a number of portals. One of them is the <a href="https://www.nomisweb.co.uk/sources/census_2021">nomis data portal</a>. This portal allows you to download census data for different geographies and different variables.</p>
<p>You may want to read <a href="https://ukdataservice.ac.uk/app/uploads/areaprofilesaccessingdata2023-02-28.pdf">this brief tutorial</a> to get a sense for how to obtain the data. We are going to get some data for Manchester city LSOAs.</p>
<p>Specifically we want to find workday population () and residential population () to be able to use the two different denominators to make comparisons. Do note that the Census data are from 2021, at a time when COVID-19 related restrictions were in place, so the workday population figures may not be representative of a typical year. The next census is not until 2031, but the ONS do publish updated population estimates over time so you may want to explore those for more up to date figures. However, for the purposes of this course, we will be working with the census data.</p>
<p>So we want to go to the <a href="https://www.nomisweb.co.uk/sources/census_2021">nomis data portal</a> and select the 2021 census data. Specifically we want residential and workday populations. To download these you have to select two different boxes. First, scroll down to the <em>Workday Population</em> box and click on that.</p>
<p><img src="img/nomis1.png" /></p>
<p>This should take you to the site <a href="https://www.nomisweb.co.uk/sources/census_2021_wd">https://www.nomisweb.co.uk/sources/census_2021_wd</a> where you can download workday population data. We want the first one in the list, which is <em>WD001 - Workday Population by population density</em>. Click on that and unzip the resulting file. This will open up a list of files where the name contains the unit of analysis at which the data are aggregated. As we are working with LSOAs we want the file ‘WD001_lsoa.csv’. Move that file to save it into your data subfolder in your project directory.</p>
<p>Next go back to the main page and choose the ‘Bulk Data Downloads’ box.</p>
<p><img src="img/nomis2.png" /></p>
<p>This will take you to <a href="https://www.nomisweb.co.uk/sources/census_2021_bulk">https://www.nomisweb.co.uk/sources/census_2021_bulk</a> where you can download the first file there ‘TS001: Number of usual residents in households and communal establishments’:</p>
<p><img src="img/nomis3.png" /></p>
<p>Use <code>read_csv()</code> function from the <code>readr</code> package to import this data.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="thematic-maps-in-r.html#cb142-1" tabindex="-1"></a>census_respop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/census2021-ts001-lsoa.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>()</span></code></pre></div>
<pre><code>## Rows: 35672 Columns: 6
## ── Column specification ────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): geography, geography code
## dbl (4): date, Residence type: Total; measures: Value, Residence type: Lives...
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="thematic-maps-in-r.html#cb144-1" tabindex="-1"></a>census_workdaypop <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/WD001_lsoa.csv&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">clean_names</span>()</span></code></pre></div>
<pre><code>## Rows: 35672 Columns: 3
## ── Column specification ────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (2): Lower layer Super Output Areas Code, Lower layer Super Output Areas...
## dbl (1): Population Density
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<p>We can join these together to create a single data frame with the two population measures we want. We can use again the <code>left_join()</code> function from the <code>dplyr</code> package to do this.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="thematic-maps-in-r.html#cb146-1" tabindex="-1"></a>census_lsoa_m <span class="ot">&lt;-</span> <span class="fu">left_join</span>(census_respop <span class="sc">%&gt;%</span> <span class="fu">select</span>(geography, geography_code, residence_type_total_measures_value), </span>
<span id="cb146-2"><a href="thematic-maps-in-r.html#cb146-2" tabindex="-1"></a>                           census_workdaypop <span class="sc">%&gt;%</span> <span class="fu">select</span>(lower_layer_super_output_areas_code,</span>
<span id="cb146-3"><a href="thematic-maps-in-r.html#cb146-3" tabindex="-1"></a>                                                        lower_layer_super_output_areas_label, </span>
<span id="cb146-4"><a href="thematic-maps-in-r.html#cb146-4" tabindex="-1"></a>                                                        population_density), </span>
<span id="cb146-5"><a href="thematic-maps-in-r.html#cb146-5" tabindex="-1"></a>                           <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;geography_code&quot;</span> <span class="ot">=</span> <span class="st">&quot;lower_layer_super_output_areas_code&quot;</span>, </span>
<span id="cb146-6"><a href="thematic-maps-in-r.html#cb146-6" tabindex="-1"></a>                                  <span class="st">&quot;geography&quot;</span> <span class="ot">=</span> <span class="st">&quot;lower_layer_super_output_areas_label&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb146-7"><a href="thematic-maps-in-r.html#cb146-7" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">respop =</span> residence_type_total_measures_value,</span>
<span id="cb146-8"><a href="thematic-maps-in-r.html#cb146-8" tabindex="-1"></a>         <span class="at">wkdpop =</span> population_density)</span></code></pre></div>
<p>You might want to save this file so you have it readily available for next time. You will be using it again in this week’s homework task for example. Make sure to save in your data folder!</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="thematic-maps-in-r.html#cb147-1" tabindex="-1"></a><span class="fu">write.csv</span>(census_lsoa_m, <span class="at">file =</span> <span class="st">&quot;data/census_lsoa_manchester.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Now that we have the file ready we can link it to our <em>manchester_lsoa</em> file using code we learned last week. We use again the <code>left_join()</code> function to add to the <em>manchester_lsoa</em> dataframe the variables that are present in the <em>census_lsoa_m</em>. The first argument in the function is the name of the dataframe to which we want to add fields, the second argument the name of the dataframe from which those fields come, and then you need to specify using “by” the name of the variables on each of these two dataframes that have the id variable that will allow us to ensure that we are linking the information across the same observations.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="thematic-maps-in-r.html#cb148-1" tabindex="-1"></a>manchester_crime_lsoa <span class="ot">&lt;-</span> <span class="fu">left_join</span>(manchester_crime_lsoa, census_lsoa_m, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;lsoa21cd&quot;</span><span class="ot">=</span><span class="st">&quot;geography_code&quot;</span>))</span></code></pre></div>
<p>And there you go… Now you have a datafile with quite a few pieces of additional information about LSOAs in Manchester.</p>
<p>The next step is to use this information.</p>
<div id="activity-4-computing-crime-rates" class="section level4 hasAnchor" number="3.5.1.1">
<h4><span class="header-section-number">3.5.1.1</span> Activity 4: Computing crime rates<a href="thematic-maps-in-r.html#activity-4-computing-crime-rates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Ok, so now we have a field that provides us with the number of crimes and two alternative counts of population for each LSOA in Manchester in the same dataframe. We could compute the rate of crime in each using the population counts as our denominator. Let’s see how the maps may compare using these different denominators.</p>
<p>But first we need to create new variables. For this we can use the <code>mutate()</code> function from the <code>dplyr</code> package. This is a very helpful function to create new variables in a dataframe based on transformations or mathematical operations performed in other variables within the dataframe. In this function, the first argument is the name of the data frame, and then we can pass as arguments all new variables we want to create as well as the instructions as to how we are creating those variables.</p>
<p>First we want to create a rate using the usual residents, since crime rates are often expressed by 1,000 inhabitants we will multiply the division of the number of crimes by the number of usual residents by 1,000. We will then create another variable, <em>crimr2</em>, using the workday population as the denominator. We will store this new variables in our existing <em>manchester_lsoa</em> dataset. You can see that below then I specify the name of a new variable <em>crimr1</em> and then I tell the function I want that variable to equal (for each case) the division of the values in the variable <em>count</em> (number of crimes) by the variable <em>respop</em> (number of people residing in the area) and then we multiply the result of this division by 1,000 to obtain a rate expressed in those terms. Then we do likewise for the alternative measure of crime.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="thematic-maps-in-r.html#cb149-1" tabindex="-1"></a>manchester_crime_lsoa <span class="ot">&lt;-</span> manchester_crime_lsoa <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="thematic-maps-in-r.html#cb149-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">crimr1 =</span> (count<span class="sc">/</span>respop)<span class="sc">*</span><span class="dv">1000</span>, </span>
<span id="cb149-3"><a href="thematic-maps-in-r.html#cb149-3" tabindex="-1"></a>         <span class="at">crimr2 =</span> (count<span class="sc">/</span>wkdpop)<span class="sc">*</span><span class="dv">1000</span>)</span></code></pre></div>
<p>And now we have two new variables, one for crime rate with residential population as a denominator, and another with workplace population as a denominator.</p>
</div>
</div>
<div id="activity-5-mapping-crime-rates" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Activity 5: Mapping crime rates<a href="thematic-maps-in-r.html#activity-5-mapping-crime-rates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have our variables for crime rate per population, we can use this to produce our crime maps!</p>
<p>Let’s first map crime count, next to residential population, and then the crime rate. We can do this by creating two maps, and then using our trusty <code>tmap_arrange()</code> to put them next to one another.</p>
<p>Let’s also use a different palette for each map, that is a different fill colour. To change the colours for the fill of the polygons you can use the palette argument within the <code>tm_fill()</code> function. You can explore different palettes running the following code:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="thematic-maps-in-r.html#cb150-1" tabindex="-1"></a>cols4all<span class="sc">::</span><span class="fu">c4a_gui</span>()</span></code></pre></div>
<p><strong>Note you have to have the shiny package installed for this to work</strong></p>
<p>Pick the ones you like, and use them. Here I will use Blues, Greens and Reds</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="thematic-maps-in-r.html#cb151-1" tabindex="-1"></a>crime_count_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span></span>
<span id="cb151-2"><a href="thematic-maps-in-r.html#cb151-2" tabindex="-1"></a>  <span class="fu">tm_fill</span>(</span>
<span id="cb151-3"><a href="thematic-maps-in-r.html#cb151-3" tabindex="-1"></a>    <span class="st">&quot;count&quot;</span>,</span>
<span id="cb151-4"><a href="thematic-maps-in-r.html#cb151-4" tabindex="-1"></a>    <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">values =</span> <span class="st">&quot;brewer.blues&quot;</span>),</span>
<span id="cb151-5"><a href="thematic-maps-in-r.html#cb151-5" tabindex="-1"></a>    <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(</span>
<span id="cb151-6"><a href="thematic-maps-in-r.html#cb151-6" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Number of crimes&quot;</span>,</span>
<span id="cb151-7"><a href="thematic-maps-in-r.html#cb151-7" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb151-8"><a href="thematic-maps-in-r.html#cb151-8" tabindex="-1"></a>      <span class="at">title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb151-9"><a href="thematic-maps-in-r.html#cb151-9" tabindex="-1"></a>      <span class="at">text.size =</span> <span class="fl">0.5</span></span>
<span id="cb151-10"><a href="thematic-maps-in-r.html#cb151-10" tabindex="-1"></a>    )</span>
<span id="cb151-11"><a href="thematic-maps-in-r.html#cb151-11" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb151-12"><a href="thematic-maps-in-r.html#cb151-12" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">&quot;Crime count&quot;</span>) </span>
<span id="cb151-13"><a href="thematic-maps-in-r.html#cb151-13" tabindex="-1"></a></span>
<span id="cb151-14"><a href="thematic-maps-in-r.html#cb151-14" tabindex="-1"></a>res_pop_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span></span>
<span id="cb151-15"><a href="thematic-maps-in-r.html#cb151-15" tabindex="-1"></a>  <span class="fu">tm_fill</span>(</span>
<span id="cb151-16"><a href="thematic-maps-in-r.html#cb151-16" tabindex="-1"></a>    <span class="st">&quot;respop&quot;</span>,</span>
<span id="cb151-17"><a href="thematic-maps-in-r.html#cb151-17" tabindex="-1"></a>    <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">values =</span> <span class="st">&quot;brewer.greens&quot;</span>),</span>
<span id="cb151-18"><a href="thematic-maps-in-r.html#cb151-18" tabindex="-1"></a>    <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(</span>
<span id="cb151-19"><a href="thematic-maps-in-r.html#cb151-19" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Residential population&quot;</span>,</span>
<span id="cb151-20"><a href="thematic-maps-in-r.html#cb151-20" tabindex="-1"></a>      <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb151-21"><a href="thematic-maps-in-r.html#cb151-21" tabindex="-1"></a>      <span class="at">title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb151-22"><a href="thematic-maps-in-r.html#cb151-22" tabindex="-1"></a>      <span class="at">text.size =</span> <span class="fl">0.5</span></span>
<span id="cb151-23"><a href="thematic-maps-in-r.html#cb151-23" tabindex="-1"></a>    )</span>
<span id="cb151-24"><a href="thematic-maps-in-r.html#cb151-24" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb151-25"><a href="thematic-maps-in-r.html#cb151-25" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">&quot;Residential population&quot;</span>) </span>
<span id="cb151-26"><a href="thematic-maps-in-r.html#cb151-26" tabindex="-1"></a>  </span>
<span id="cb151-27"><a href="thematic-maps-in-r.html#cb151-27" tabindex="-1"></a></span>
<span id="cb151-28"><a href="thematic-maps-in-r.html#cb151-28" tabindex="-1"></a>crime_rate_map <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(manchester_crime_lsoa) <span class="sc">+</span> </span>
<span id="cb151-29"><a href="thematic-maps-in-r.html#cb151-29" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;crimr1&quot;</span>, </span>
<span id="cb151-30"><a href="thematic-maps-in-r.html#cb151-30" tabindex="-1"></a>          <span class="at">fill.scale =</span> <span class="fu">tm_scale_intervals</span>(<span class="at">values =</span> <span class="st">&quot;brewer.reds&quot;</span>), </span>
<span id="cb151-31"><a href="thematic-maps-in-r.html#cb151-31" tabindex="-1"></a>          <span class="at">fill.legend =</span> <span class="fu">tm_legend</span>(</span>
<span id="cb151-32"><a href="thematic-maps-in-r.html#cb151-32" tabindex="-1"></a>            <span class="at">title =</span> <span class="st">&quot;Crimes per 1000 population&quot;</span>,</span>
<span id="cb151-33"><a href="thematic-maps-in-r.html#cb151-33" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;right&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb151-34"><a href="thematic-maps-in-r.html#cb151-34" tabindex="-1"></a>            <span class="at">title.size =</span> <span class="fl">0.8</span>,</span>
<span id="cb151-35"><a href="thematic-maps-in-r.html#cb151-35" tabindex="-1"></a>            <span class="at">text.size =</span> <span class="fl">0.5</span>)) <span class="sc">+</span> </span>
<span id="cb151-36"><a href="thematic-maps-in-r.html#cb151-36" tabindex="-1"></a>  <span class="fu">tm_title</span>(<span class="st">&quot;Crime rate&quot;</span>)</span>
<span id="cb151-37"><a href="thematic-maps-in-r.html#cb151-37" tabindex="-1"></a></span>
<span id="cb151-38"><a href="thematic-maps-in-r.html#cb151-38" tabindex="-1"></a><span class="fu">tmap_arrange</span>(crime_count_map, res_pop_map, crime_rate_map)</span></code></pre></div>
<p><img src="crime_mapping_textbook_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>What do you think about these three maps? How do you think this might be different if we were to look at workday population instead of residential population as a denominator? Discuss in your groups.</p>
<p>Once you have completed this activity, let’s explore your map with the crime rate using the usual residents as the denominator using the interactive way. Assuming you want to display ‘crime_rate_map’ we just created, you could use the following code.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="thematic-maps-in-r.html#cb152-1" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;view&quot;</span>)</span>
<span id="cb152-2"><a href="thematic-maps-in-r.html#cb152-2" tabindex="-1"></a>crime_rate_map</span></code></pre></div>
<p>You may find it useful to shift to the OpenStreetMap view by clicking in the box to the left, since it will give you a bit more contextual information than the default CartoDB basemap.</p>
<p>In the first lecture we spoke a bit about Open Street Map, but if you’re interested it’s definitely worth reading up on. As I mentioned, Open Street Map is a non-profit foundation whose aim is to support and enable the development of freely-reusable geospatial data, and relies heavily on volunteers participating in this project to map their local areas. You can have a look <a href="https://www.hotosm.org/get-involved/disaster-mapping">here</a> for ongoing humanitarian projects, or read <a href="https://wiki.openstreetmap.org/wiki/Mapping_parties">here</a> about the mapping parties I told you about. At the very least though, in the spirit of open source and crowdsourcing, take a moment to appreciate that all these volunteers of people just like you have contributed to creating such a detailed geographical database of our world. That’s definitely something kinda cool to think about!</p>
<p><img src="img/shiftingbasemap.PNG" /></p>
</div>
</div>
<div id="summary-2" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Summary<a href="thematic-maps-in-r.html#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This week we learned some basic principles of thematic maps. We learned how to make them using the tmap package, we learned about the importance of classification schemes, and how each one may produce a different looking map, which may tell a different story. We learned how to access population data from the UK census, and how we can use that to calculate crime rates instead of crime counts. Taking this forward, make sure to think critically about the decisions that go into producing your thematic maps</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="making-maps-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="performing-spatial-operations-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": "https://github.com/rstudio/bookdown-demo/edit/master/03-week3.Rmd",
    "text": "Edit"
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["crime_mapping_textbook.pdf", "crime_mapping_textbook.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
